'use strict';

var debug = require('debug')('hdbext:sp');

module.exports = {
  execWithPrepare: execWithPrepare,
  isInput: isInput,
  isInputTable: isInputTable,
  hasDefaultValue: hasDefaultValue
};

function execWithPrepare(client, sql, args, cb) {
  client.prepare(sql, function (err, statement) {
    if (err) {
      return cb(err);
    }
    statement.exec(args, function () {
      statement.drop(function (err) {
        if (err) {
          debug('Could not drop prepared statement (%s).', sql, err);
        }
      });

      cb.apply(null, arguments);
    });
  });
}

function isInput(paramMeta) {
  return paramMeta.PARAMETER_TYPE === 'IN' || paramMeta.PARAMETER_TYPE === 'INOUT';
}

function isInputTable(paramMeta) {
  return isInput(paramMeta) && paramMeta.DATA_TYPE_NAME === 'TABLE_TYPE';
}

function hasDefaultValue(paramMeta) {
  return paramMeta.HAS_DEFAULT_VALUE === 'TRUE';
}

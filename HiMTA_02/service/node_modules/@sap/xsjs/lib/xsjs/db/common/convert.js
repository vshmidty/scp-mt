'use strict';

var _ = require('lodash');
var types = require('@sap/hdbext').constants.types;
var bufferUtils = require('../../../utils/buffer-utils');

module.exports = function (sqlArg, dataType) {
  if (_.isNil(sqlArg) || (_.isNumber(sqlArg) && !_.isFinite(sqlArg))) {
    return sqlArg;
  }

  var realType = _.isString(dataType) ? types[dataType] : dataType;
  switch (realType) {
  case types.BINARY:
  case types.VARBINARY:
    return bufferUtils.toBuffer(sqlArg);

  case types.ALPHANUM:
  case types.CHAR:
  case types.DECIMAL:
  case types.NCHAR:
  case types.NSTRING:
  case types.NVARCHAR:
  case types.SHORTTEXT:
  case types.SMALLDECIMAL:
  case types.STRING:
  case types.VARCHAR:
    return toString(sqlArg);

  default:
    return sqlArg;
  }
};

function toString(arg) {
  if (_.isString(arg)) {
    return arg;
  }
  if (bufferUtils.isBuffer(arg)) {
    return arg.toString('utf8');
  }
  return '' + arg;
}

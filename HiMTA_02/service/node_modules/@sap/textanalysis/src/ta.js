// Copyright 2016 SAP SE.
//
'use strict';

exports.analyze = function(values, client, cb) {
  var sqlCALL = 'call TA_ANALYZE (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)';
  client.prepare(sqlCALL, function(err, st) {
    if(err) {
		// Check if TA_ANALYZE is implemented in this HANA version
		if(err.code == 328 && err.message.substr(0, 49) == 'invalid name of function or procedure: TA_ANALYZE') {
			return cb(new Error('This HANA version does not support analyze()'));
		} else
			return cb(err);
 	}
    st.exec(values, function(err, parameters, rows) {
      st.drop();
      cb(err, parameters, rows);
    })
  });
}

